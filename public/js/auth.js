// 1. Xử lý Bật/Tắt hiển thị mật khẩu
const toggleBtns = document.querySelectorAll('.toggle-password');

toggleBtns.forEach(btn => {
    btn.addEventListener('click', function () {
        const input = this.parentElement.querySelector('input');
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);

        if (type === 'text') {
            this.innerHTML = `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 3.125C14.1409 3.12513 17.6529 5.80941 18.8945 9.53125L18.9277 9.64648C18.9945 9.91477 18.9825 10.1965 18.8945 10.46L18.8955 10.4609C17.6582 14.1864 14.1436 16.8749 10 16.875C5.98733 16.875 2.5646 14.3543 1.22656 10.8115L1.10352 10.4658C1.00339 10.1649 1.00339 9.83902 1.10352 9.53809C2.34193 5.81303 5.85644 3.125 10 3.125ZM10 4.375C6.41054 4.375 3.36256 6.7031 2.28906 9.93262V9.93359C2.27443 9.97794 2.27448 10.026 2.28906 10.0703C3.36489 13.2985 6.41202 15.625 10 15.625C13.5893 15.6249 16.6363 13.2966 17.709 10.0674L17.71 10.0645C17.7247 10.0203 17.7242 9.97384 17.71 9.93164L17.709 9.92969C16.6332 6.70147 13.5878 4.37513 10 4.375ZM10 6.875C10.8288 6.87503 11.6239 7.20401 12.21 7.79004C12.796 8.37609 13.125 9.17122 13.125 10C13.125 10.8288 12.796 11.6239 12.21 12.21C11.6239 12.796 10.8288 13.125 10 13.125C9.17122 13.125 8.37609 12.796 7.79004 12.21C7.20399 11.6239 6.875 10.8288 6.875 10C6.875 9.1712 7.20399 8.37609 7.79004 7.79004C8.37609 7.20402 9.17122 6.875 10 6.875ZM10 8.125C9.50274 8.125 9.02545 8.32223 8.67383 8.67383C8.3222 9.02546 8.125 9.50272 8.125 10C8.125 10.4973 8.3222 10.9745 8.67383 11.3262C9.02545 11.6778 9.50274 11.875 10 11.875C10.4972 11.875 10.9746 11.6778 11.3262 11.3262C11.6778 10.9745 11.875 10.4973 11.875 10C11.875 9.50274 11.6778 9.02545 11.3262 8.67383C10.9746 8.32222 10.4972 8.12503 10 8.125Z" fill="#646464"/></svg>`;
        } else {
            this.innerHTML = `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.05725 2.05736C2.30114 1.81366 2.69697 1.81395 2.94104 2.05736L5.28186 4.39818C6.71104 3.56415 8.33883 3.12239 9.99963 3.12474C14.2467 3.12489 17.8325 5.94944 18.986 9.82006C19.0206 9.93649 19.0207 10.0611 18.986 10.1775C18.4267 12.0486 17.2989 13.6913 15.7701 14.8865L17.941 17.0574C18.1851 17.3014 18.1851 17.698 17.941 17.9421C17.697 18.1858 17.3012 18.1859 17.0572 17.9421L14.3678 15.2517L7.79455 8.67846C7.79312 8.67716 7.79104 8.67592 7.78967 8.67455L7.78869 8.67357L4.74768 5.63158L2.05725 2.94213C1.81348 2.69803 1.8133 2.30134 2.05725 2.05736ZM2.83948 6.44799C3.06257 6.18502 3.45708 6.15297 3.72034 6.37572C3.98336 6.59891 4.01564 6.99334 3.7926 7.25658C3.10921 8.06322 2.59242 8.99603 2.26721 10.0007C3.32305 13.2651 6.38649 15.6246 9.99963 15.6247C10.7687 15.6247 11.5118 15.5178 12.2155 15.3191C12.5475 15.2254 12.893 15.4188 12.9869 15.7507C13.0807 16.0828 12.8873 16.4283 12.5553 16.5222C11.7426 16.7517 10.8851 16.8747 9.99963 16.8747C5.75254 16.8746 2.16582 14.0508 1.01233 10.1785C0.977725 10.062 0.977599 9.93742 1.01233 9.82103C1.38187 8.58273 2.0041 7.43394 2.83948 6.44799ZM9.99866 4.37474C8.67055 4.37278 7.3663 4.69871 6.19983 5.31713L8.276 7.3933C8.44198 7.28355 8.61864 7.18958 8.80334 7.11303C9.18239 6.95602 9.58936 6.8748 9.99963 6.87474C10.4099 6.87474 10.8169 6.95607 11.1959 7.11303C11.5749 7.27003 11.9195 7.50077 12.2096 7.79076C12.4996 8.08083 12.7303 8.4255 12.8873 8.80443C13.0442 9.1833 13.1245 9.58968 13.1246 9.99974C13.1246 10.41 13.0443 10.8169 12.8873 11.196C12.8109 11.3806 12.7157 11.5565 12.6061 11.7224L14.8785 13.9949C16.2163 12.989 17.2127 11.5939 17.7301 9.99681C16.674 6.73435 13.6124 4.37489 9.99963 4.37474H9.99866ZM9.99963 8.12474C9.75351 8.1248 9.50924 8.17314 9.28186 8.26732C9.25161 8.27987 9.22248 8.29525 9.19299 8.30931L11.6891 10.8054C11.7031 10.7761 11.7196 10.7476 11.7321 10.7175C11.8262 10.4901 11.8746 10.2459 11.8746 9.99974C11.8745 9.75383 11.8261 9.51016 11.7321 9.28295C11.6379 9.05568 11.4997 8.84854 11.3258 8.67455C11.1517 8.50056 10.9448 8.36151 10.7174 8.26732C10.49 8.1732 10.2457 8.12474 9.99963 8.12474Z" fill="#646464"/></svg>`;
        }
    });
});

// 2. Xử lý Gửi Form Đăng Ký
const registerForm = document.getElementById('register-form');
const statusText = document.getElementById('statusText');

registerForm.addEventListener('submit', async function (e) {
    e.preventDefault();

    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const rePassword = document.getElementById('confirmPassword').value;

    // Kiểm tra mật khẩu khớp
    if (password !== rePassword) {
        statusText.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.70035 1.5015C5.27785 0.501495 6.72184 0.501495 7.29884 1.5015L10.9763 7.87549C11.5533 8.87549 10.8313 10.1255 9.67685 10.1255H2.32235C1.16785 10.1255 0.446345 8.87549 1.02335 7.87549L4.69985 1.5015H4.70035ZM5.99985 4.12499C6.0993 4.12499 6.19468 4.1645 6.26501 4.23483C6.33534 4.30516 6.37485 4.40054 6.37485 4.49999V6.37499C6.37485 6.47445 6.33534 6.56983 6.26501 6.64016C6.19468 6.71049 6.0993 6.74999 5.99985 6.74999C5.90039 6.74999 5.80501 6.71049 5.73468 6.64016C5.66435 6.56983 5.62485 6.47445 5.62485 6.37499V4.49999C5.62485 4.40054 5.66435 4.30516 5.73468 4.23483C5.80501 4.1645 5.90039 4.12499 5.99985 4.12499ZM5.99985 8.24999C6.0993 8.24999 6.19468 8.21049 6.26501 8.14016C6.33534 8.06983 6.37485 7.97445 6.37485 7.87499C6.37485 7.77554 6.33534 7.68016 6.26501 7.60983C6.19468 7.5395 6.0993 7.49999 5.99985 7.49999C5.90039 7.49999 5.80501 7.5395 5.73468 7.60983C5.66435 7.68016 5.62485 7.77554 5.62485 7.87499C5.62485 7.97445 5.66435 8.06983 5.73468 8.14016C5.80501 8.21049 5.90039 8.24999 5.99985 8.24999Z" fill="#D21751"/>
            </svg> The password entered again doesn't match!`;
        // statusText.style.color = "#D21751";
        return;
    }

    const userData = { username, password };

    try {
        statusText.innerText = "Processing...";

        const response = await fetch('http://localhost:3000/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(userData)
        });

        const result = await response.json();

        if (response.ok) {
            statusText.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.7297 4.02813C15.921 3.74115 16.3098 3.6634 16.5969 3.8543C16.884 4.04573 16.962 4.43431 16.7707 4.72149L9.27073 15.9715C9.16686 16.1273 8.99808 16.2284 8.81174 16.2469C8.62557 16.2652 8.44013 16.1995 8.30784 16.0672L3.30784 11.0672C3.06415 10.8231 3.06396 10.4264 3.30784 10.1824C3.55179 9.93847 3.9485 9.93872 4.1926 10.1824L8.65256 14.6424L15.7297 4.02813Z" fill="#22C55E"/>
                </svg> ${result.message}`;
            // statusText.style.color = "#1a1a1a";
            registerForm.reset(); 
        } else {
            statusText.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.83391 2.5025C8.79641 0.835836 11.2031 0.835836 12.1647 2.5025L18.2939 13.1258C19.2556 14.7925 18.0522 16.8758 16.1281 16.8758H3.87058C1.94641 16.8758 0.743909 14.7925 1.70558 13.1258L7.83307 2.5025H7.83391ZM9.99974 6.875C10.1655 6.875 10.3245 6.94085 10.4417 7.05806C10.5589 7.17527 10.6247 7.33424 10.6247 7.5V10.625C10.6247 10.7908 10.5589 10.9497 10.4417 11.0669C10.3245 11.1842 10.1655 11.25 9.99974 11.25C9.83398 11.25 9.67501 11.1842 9.5578 11.0669C9.44059 10.9497 9.37474 10.7908 9.37474 10.625V7.5C9.37474 7.33424 9.44059 7.17527 9.5578 7.05806C9.67501 6.94085 9.83398 6.875 9.99974 6.875ZM9.99974 13.75C10.1655 13.75 10.3245 13.6842 10.4417 13.5669C10.5589 13.4497 10.6247 13.2908 10.6247 13.125C10.6247 12.9592 10.5589 12.8003 10.4417 12.6831C10.3245 12.5658 10.1655 12.5 9.99974 12.5C9.83398 12.5 9.67501 12.5658 9.5578 12.6831C9.44059 12.8003 9.37474 12.9592 9.37474 13.125C9.37474 13.2908 9.44059 13.4497 9.5578 13.5669C9.67501 13.6842 9.83398 13.75 9.99974 13.75Z" fill="#D21751"/>
                </svg> ${result.message}`;
            // statusText.style.color = "#1a1a1a";
        }

    } catch (error) {
        statusText.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.70035 1.5015C5.27785 0.501495 6.72184 0.501495 7.29884 1.5015L10.9763 7.87549C11.5533 8.87549 10.8313 10.1255 9.67685 10.1255H2.32235C1.16785 10.1255 0.446345 8.87549 1.02335 7.87549L4.69985 1.5015H4.70035ZM5.99985 4.12499C6.0993 4.12499 6.19468 4.1645 6.26501 4.23483C6.33534 4.30516 6.37485 4.40054 6.37485 4.49999V6.37499C6.37485 6.47445 6.33534 6.56983 6.26501 6.64016C6.19468 6.71049 6.0993 6.74999 5.99985 6.74999C5.90039 6.74999 5.80501 6.71049 5.73468 6.64016C5.66435 6.56983 5.62485 6.47445 5.62485 6.37499V4.49999C5.62485 4.40054 5.66435 4.30516 5.73468 4.23483C5.80501 4.1645 5.90039 4.12499 5.99985 4.12499ZM5.99985 8.24999C6.0993 8.24999 6.19468 8.21049 6.26501 8.14016C6.33534 8.06983 6.37485 7.97445 6.37485 7.87499C6.37485 7.77554 6.33534 7.68016 6.26501 7.60983C6.19468 7.5395 6.0993 7.49999 5.99985 7.49999C5.90039 7.49999 5.80501 7.5395 5.73468 7.60983C5.66435 7.68016 5.62485 7.77554 5.62485 7.87499C5.62485 7.97445 5.66435 8.06983 5.73468 8.14016C5.80501 8.21049 5.90039 8.24999 5.99985 8.24999Z" fill="#D21751"/>
            </svg> Unable to connect to the server!`;
        // statusText.style.color = "#1a1a1a";
        console.error("Lỗi Fetch:", error);
    }
});